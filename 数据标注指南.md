# NER数据标注指南

## 一、什么是NER（命名实体识别）

命名实体识别是指从文本中识别出特定类型的实体。本项目专注于技术文档的实体识别，包括：
- **技术术语**（TECH）：Form A、FTIR、XRPD、TGA、UV等
- **数值**（NUM）：252、15.6、3.3等数字
- **单位**（UNIT）：°C、mg/mL、nm、pH等度量单位

### 通用实体类型（扩展用）
如需识别其他类型，可扩展为：
- **人名**（PER）：张三、李四
- **地名**（LOC）：北京、上海  
- **组织机构**（ORG）：阿里巴巴、清华大学
- **时间**（TIME）：2024年、明天上午

## 二、数据标注前的准备

### 2.1 明确标注规范
在开始标注前，需要明确：
1. **实体类型定义**：确定需要识别哪些类型的实体
2. **标注边界规则**：确定实体的起始和结束位置
3. **特殊情况处理**：如嵌套实体、歧义实体的处理方式

### 2.2 准备原始数据
- 收集业务相关的文本数据
- 确保数据覆盖各种典型场景
- 建议初期准备500-1000条句子

## 三、推荐的标注工具

### 3.1 Label Studio（推荐）
**优点**：
- 开源免费
- 支持团队协作
- 界面友好，支持中文
- 可导出多种格式

**安装方法**：
```bash
pip install label-studio
label-studio
```

**使用步骤**：
1. 创建项目，选择"Named Entity Recognition"模板
2. 配置实体类型标签
3. 导入文本数据
4. 开始标注
5. 导出为JSON格式

### 3.2 Doccano
**优点**：
- 专为文本标注设计
- 支持Docker部署
- 适合团队使用

**安装方法**：
```bash
pip install doccano
doccano createuser --username admin --password pass
doccano webserver --port 8000
```

### 3.3 简易标注方法（适合小数据集）

如果数据量较小，可以使用Excel或文本编辑器手动标注：

**Excel标注格式示例**：
| 句子 | 实体文本 | 实体类型 | 起始位置 | 结束位置 |
|------|---------|---------|---------|---------|
| 张三在北京工作 | 张三 | PER | 0 | 2 |
| 张三在北京工作 | 北京 | LOC | 3 | 5 |

## 四、标注格式说明

### 4.1 BIO标注格式
最常用的标注格式，每个字符都有一个标签：
- **B-类型**：实体开始
- **I-类型**：实体内部
- **O**：非实体

**技术文档示例**：
```
F B-TECH
o I-TECH
r I-TECH
m I-TECH
  I-TECH
A I-TECH
在 O
2 B-NUM
5 I-NUM
2 I-NUM
° B-UNIT
C I-UNIT
时 O
```

### 4.2 JSON格式（本项目使用）
```json
{
  "text": "Form A在252°C时熔化",
  "tokens": ["F", "o", "r", "m", " ", "A", "在", "2", "5", "2", "°", "C", "时", "熔", "化"],
  "labels": ["B-TECH", "I-TECH", "I-TECH", "I-TECH", "I-TECH", "I-TECH", "O", "B-NUM", "I-NUM", "I-NUM", "B-UNIT", "I-UNIT", "O", "O", "O"]
}
```

## 五、标注步骤详解

### 步骤1：理解文本内容
仔细阅读待标注的文本，理解上下文含义

### 步骤2：识别实体
根据定义的实体类型，找出文本中的所有实体

### 步骤3：确定边界
准确标记实体的起始和结束位置
- **注意**：位置从0开始计数
- **结束位置**：不包含在实体内（左闭右开）

### 步骤4：选择类型
为每个实体分配正确的类型标签

### 步骤5：检查验证
- 检查是否有遗漏的实体
- 验证边界是否准确
- 确认类型是否正确

## 六、标注示例

### 示例1：技术文档
**原文**：`溶解度为7.1 mg/mL`

**标注结果**：
```json
{
  "text": "溶解度为7.1 mg/mL",
  "entities": [
    {"start": 4, "end": 7, "label": "NUM"},
    {"start": 8, "end": 13, "label": "UNIT"}
  ]
}
```

### 示例2：复杂技术描述
**原文**：`FTIR分析显示在252nm处有吸收峰`

**标注结果**：
```json
{
  "text": "FTIR分析显示在252nm处有吸收峰",
  "entities": [
    {"start": 0, "end": 4, "label": "TECH"},
    {"start": 9, "end": 12, "label": "NUM"},
    {"start": 12, "end": 14, "label": "UNIT"}
  ]
}
```

## 七、常见问题与处理

### 7.1 实体边界不清
**问题**：`中国银行` 是标注 `中国` 还是 `中国银行`？
**解决**：根据语义，`中国银行` 作为整体是一个组织机构

### 7.2 嵌套实体
**问题**：`北京大学医学部` 包含地名和组织名
**解决**：选择最外层、最完整的实体类型（ORG）

### 7.3 歧义实体
**问题**：`苹果` 可能是水果或公司
**解决**：根据上下文判断，必要时查看前后文

### 7.4 缩写和别名
**问题**：`北大` 和 `北京大学` 
**解决**：都标注为ORG，保持一致性

## 八、标注质量检查

### 8.1 一致性检查
- 相同的实体在不同句子中标注类型应一致
- 相似的实体应遵循相同的标注规则

### 8.2 完整性检查
- 检查是否有遗漏的实体
- 确保常见实体都被标注

### 8.3 准确性检查
- 实体边界是否准确
- 实体类型是否正确

### 8.4 建议的检查流程
1. 完成100条标注后进行第一次检查
2. 邀请他人交叉检查
3. 记录并解决分歧案例
4. 更新标注规范

## 九、数据集规模建议

| 任务复杂度 | 最少数据量 | 建议数据量 | 理想数据量 |
|-----------|-----------|-----------|-----------|
| 简单（3-5种实体） | 500条 | 2000条 | 5000条+ |
| 中等（5-10种实体） | 1000条 | 5000条 | 10000条+ |
| 复杂（10种以上） | 2000条 | 10000条 | 20000条+ |

## 十、数据导出与使用

### 10.1 从Label Studio导出
1. 选择"Export"功能
2. 选择"JSON"格式
3. 下载数据文件

### 10.2 数据格式转换
如果使用其他工具，可能需要转换格式。以下是转换为本项目格式的Python代码：

```python
import json

def convert_to_project_format(input_file, output_file):
    """
    将标注数据转换为项目所需格式
    """
    with open(input_file, 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    converted_data = []
    for item in data:
        # 根据实际格式调整
        text = item['text']
        entities = []
        for annotation in item['annotations']:
            for result in annotation['result']:
                entities.append({
                    'start': result['value']['start'],
                    'end': result['value']['end'],
                    'label': result['value']['labels'][0]
                })
        
        converted_data.append({
            'text': text,
            'entities': entities
        })
    
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(converted_data, f, ensure_ascii=False, indent=2)
```

## 十一、最佳实践建议

### 11.1 标注前
- 制定详细的标注指南
- 进行小规模试标注
- 团队讨论并统一标准

### 11.2 标注中
- 保持专注，避免疲劳标注
- 遇到困难案例及时记录
- 定期回顾和调整规范

### 11.3 标注后
- 进行质量检查
- 计算标注一致性
- 整理困难案例供培训使用

## 十二、进阶技巧

### 12.1 使用预标注
可以先用现有模型进行预标注，然后人工修正：
```python
# 使用现有模型预标注
from transformers import pipeline

nlp = pipeline("ner", model="bert-base-chinese")
result = nlp("张三在北京工作")
# 将结果转换为标注格式，供人工检查修正
```

### 12.2 主动学习
优先标注模型不确定的样本，提高标注效率

### 12.3 数据增强
通过替换实体、改写句子等方式扩充数据集

## 十三、联系与支持

如果在标注过程中遇到问题，可以：
1. 查阅本文档相关章节
2. 记录具体问题和示例
3. 与技术团队讨论解决方案

---

**附录：快速参考卡**

### 常用实体类型缩写

#### 技术文档实体（本项目使用）
- TECH: 技术术语（Form A、FTIR、UV、TGA等）
- NUM: 数值（252、7.1、3.3等）
- UNIT: 单位（°C、mg/mL、nm、pH等）

#### 通用实体（扩展用）
- PER: 人名
- LOC: 地名  
- ORG: 组织机构
- TIME: 时间
- DATE: 日期
- MONEY: 金额
- PERCENT: 百分比

### 标注检查清单
- [ ] 实体是否完整？
- [ ] 边界是否准确？
- [ ] 类型是否正确？
- [ ] 是否有遗漏？
- [ ] 是否保持一致？